<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mapa Leaflet</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="qrc:///qtwebchannel/qwebchannel.js"></script>
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
  </style>
</head>
<body>
  <div id="map">Hellow</div>

  <script>
    // Inicjalizacja mapy
    var map = L.map('map').setView([52.23, 21.01], 13);

    const markersGroup = L.layerGroup().addTo(map)

    // Kafelki OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    new QWebChannel(qt.webChannelTransport, function(channel) {

      // Komunikacja z Pythonem
      window.backend = channel.objects.backend;

      function addMarker(lat,lon,name,color)
      {
        var marker = L.circleMarker([lat,lon], {
          radius: 5,
          color: color,
          fillColor: color,
          fillOpacity: 0.8
        })
        .addTo(markersGroup)
        .on("click", () => {
          backend.on_marker_click(name)
        });
      }

      function resetMarkers()
      {
        markersGroup.clearLayers()
      }

      backend.addMarker.connect(addMarker)
      backend.resetMarkers.connect(resetMarkers)
    });
  </script>
</body>
</html>
